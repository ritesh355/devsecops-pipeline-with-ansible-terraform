---
- name: Install dependencies
  apt:
    name: ['docker.io', 'openjdk-17-jdk']
    state: present
    update_cache: yes

- name: Enable and start Docker
  systemd:
    name: docker
    enabled: yes
    state: started

- name: Add ubuntu user to Docker group
  user:
    name: ubuntu
    groups: docker
    append: yes

- name: Run Jenkins container (with auto-restart)
  docker_container:
    name: jenkins
    image: jenkins/jenkins:lts
    state: started
    restart_policy: always
    published_ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - jenkins_home:/var/jenkins_home

